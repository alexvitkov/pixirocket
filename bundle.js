(()=>{var h=800,r=600,T=.015,a={GRAVITY_SCALE:.14,ROTATION_SCALE:.001,MAX_ROTATION_SPEED:.1,SCALE_DECREASE:.003},d={INITIAL_Y_SPEED:1.5,Y_SPEED_CHANGE:-.015,ALPHA_DECREASE:.007};var p=[],x=class{constructor(t,e){this.scaleAdd=0,this.yAdd=d.INITIAL_Y_SPEED,this.text=t,this.isAlive=!0,this.animatePosition=e,this.tickerFn=this.tick.bind(this),o.ticker.add(this.tickerFn)}destroy(){this.text.destroy(),this.isAlive=!1,o.ticker.remove(this.tickerFn)}tick(){let t=o.ticker.deltaTime;if(this.scaleAdd-=1e-4*t,this.animatePosition){let e=this.text.scale.x+this.scaleAdd*t;this.text.scale.set(e),this.yAdd+=d.Y_SPEED_CHANGE*t,this.yAdd<0&&(this.yAdd=0),this.text.y-=this.yAdd*t}this.text.alpha-=d.ALPHA_DECREASE*t,this.text.alpha<=0&&this.destroy()}};function n(i,t){let e=new PIXI.Text(i,{fontFamily:"Arial",fontSize:40,fill:"yellow",stroke:"black",align:"center",strokeThickness:5});e.zIndex=1e3,t&&t.location==="left"?(e.x=0,e.y=r,e.anchor.set(0,1)):(e.x=h/2,e.y=r/2,e.anchor.set(.5));let s=new x(e,!(t&&t.location==="left"));t&&t.group!==void 0&&(p[t.group]&&p[t.group].isAlive&&p[t.group].destroy(),p[t.group]=s),o.stage.addChild(e)}var c=class{constructor(t,e){this.width=t,this.height=e,this.container=new PIXI.Container,this.container.y=-e,this.fuelBar=new PIXI.Graphics,this.container.addChild(this.fuelBar),this.update(1)}update(t){this.fuelBar.clear(),this.fuelBar.beginFill(0),this.fuelBar.lineStyle(2,16711680),this.fuelBar.drawRect(0,0,this.width,this.height),this.fuelBar.beginFill(16776960),this.fuelBar.lineStyle(2,16711680),this.fuelBar.drawRect(0,(1-t)*this.height,this.width,t*this.height)}};function E(i,t,e){return e*(t-i)+i}function I(i,t){return E(i,t,Math.random())}function l(i,t,e){return i<t?t:i>e?e:i}var g=class{constructor(t,e){this.sprite=t,this.velocity=e,this.angularVelocity=0;let s=t.getGlobalPosition();app.stage.addChild(t),t.x=s.x,t.y=s.y,this.tickFn=this.tick.bind(this),app.ticker.add(this.tickFn)}tick(){let t=app.ticker.deltaTime;this.velocity+=a.GRAVITY_SCALE*t,this.angularVelocity+=a.ROTATION_SCALE*t,this.angularVelocity>a.MAX_ROTATION_SPEED&&(this.angularVelocity=a.MAX_ROTATION_SPEED),this.sprite.y+=a.GRAVITY_SCALE*this.velocity,this.sprite.rotation+=this.angularVelocity*t,this.sprite.scale.set(this.sprite.scale.x-a.SCALE_DECREASE*t),this.sprite.scale.x<0&&(app.ticker.remove(this.tickFn),this.sprite.destroy())}};var y=PIXI.Texture.from("assets/rocket_top.png"),m=PIXI.Texture.from("assets/rocket_bottom.png"),F=PIXI.Texture.from("assets/thrust.png"),C=class{constructor(t,e){this.rocketData=e,this.stage=1,this.stage1Fuel=e.first_stage.fuel_amount_tons,this.stage2Fuel=e.second_stage.fuel_amount_tons,this.fuel=this.stage1Fuel+this.stage2Fuel,this.launched=!1,this.container=new PIXI.Container,this.rocketScale=e.height.meters*T,this.rocketSize=this.rocketScale*(y.height+m.height),this.rocketTop=new PIXI.Sprite(y),this.rocketTop.anchor.set(.5,1.5),this.rocketTop.scale.set(this.rocketScale),this.rocketBottom=new PIXI.Sprite(m),this.rocketBottom.scale.set(this.rocketScale),this.rocketBottom.anchor.set(.5,.5),this.rocketBottom.y=-m.height*this.rocketScale*.5,this.thrustSprite=new PIXI.Sprite(F),this.thrustSprite.anchor.set(.5,.1),this.container.addChild(this.thrustSprite),this.container.addChild(this.rocketBottom),this.container.addChild(this.rocketTop);let s=new PIXI.Text(e.name,{fontFamily:"Arial",fontSize:20,fill:16777215});s.anchor.set(.5),s.y=-this.rocketSize-15,this.container.addChild(s),this.fuelBar1=new c(10,this.rocketSize),this.container.addChild(this.fuelBar1.container),this.fuelBar1.container.x=this.rocketTop.width/2+5,this.fuelBar2=new c(10,this.rocketSize*this.stage2Fuel/(this.stage1Fuel+this.stage2Fuel)),this.container.addChild(this.fuelBar2.container),this.fuelBar2.container.x=this.fuelBar1.container.x+10,this.container.x=t,o.stage.addChild(this.container),this.tickFn=this.tick.bind(this),o.ticker.add(this.tickFn)}launch(){this.launched=!0}destroy(){this.onDestroyCallback&&this.onDestroyCallback(),this.container.destroy(),n(`${this.rocketData.name} launched!`),o.ticker.remove(this.tickFn)}updateY(){let t=this.fuel/(this.stage1Fuel+this.stage2Fuel);t=1-(1-t)*(1-t);let e=this.container.y,s=Math.log(this.stage1Fuel+this.stage2Fuel)/10*r,u=r-s*(1-t);this.container.y=u,this.yVelocity=(u-e)/o.ticker.deltaTime}enterStage2(){this.stage!=2&&(this.stage=2,new g(this.rocketBottom,l(this.yVelocity,-10,0)))}onDestroy(t){this.onDestroyCallback=t}tick(){if(this.updateY(),!this.launched)return;let t=o.ticker.deltaTime,e=o.ticker.deltaMS/1e3;if(this.fuel-=f*e,this.fuel<this.stage2Fuel&&this.stage==1&&this.enterStage2(),this.fuel<=0){this.destroy();return}if(this.thrustSprite.rotation=Math.random()*.1,this.thrustSprite.scale.set(this.rocketScale*I(.9,1.1)),this.fuelBar1.update(l((this.fuel-this.stage2Fuel)/this.stage1Fuel,0,1)),this.fuelBar2.update(l(this.fuel/this.stage2Fuel,0,1)),this.stage==2){let s=-this.rocketScale*m.height;this.thrustSprite.y=E(this.thrustSprite.y,s,.1*t)}this.container.alpha=l(3*this.fuel/f,0,1)}};var S,k,o=app=new PIXI.Application({width:h,height:r}),f=20;window.increaseTimeScale=function(){f*=1.5,n(`Time scale: ${Math.floor(f)}:1`,{location:"left",group:1})};function A(i){if(n(i==0?"Launch!":i),k=S.length,i==0)for(let t of S)t.launch(),t.onDestroy(()=>{k-=1,k==0&&setTimeout(()=>n("Success!"),1e3)});else setTimeout(()=>A(i-1),1e3)}async function B(){document.body.appendChild(app.view),app.stage.sortableChildren=!0;let i=PIXI.Sprite.from("assets/bg.jpg");i.width=h,i.height=r,app.stage.addChild(i);let e=await(await fetch("https://api.spacexdata.com/v2/rockets")).json(),s=h/(e.length+1),u=0;S=e.map(_=>new C(u+=s,_)),A(3)}B();})();
//# sourceMappingURL=bundle.js.map
